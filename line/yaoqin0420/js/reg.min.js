
$.fn.watch=function(callback){return this.each(function(){$.data(this,'originVal',$(this).val());$(this).on('keyup paste',function(){var originVal=$(this,'originVal');var currentVal=$(this).val();if(originVal!==currentVal){$.data(this,'originVal',$(this).val());callback(currentVal);}});});};Object.assign=Object.assign||function(target){if(target==null){throw new TypeError('Cannot convert undefined or null to object');}
target=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments[index];if(source!=null){for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}}
return target;};$.urlParamStar=function(name){var results=new RegExp('[\?\*]'+name+'=([^*#]*)').exec(window.location.href);if(results){return decodeURI(results[1])||0;}else{return null;}};$.urlParam=function(name){var results=new RegExp('[\?&]'+name+'=([^&#]*)').exec(window.location.href);if(results==null){return $.urlParamStar(name);}
if(results[1]&&results[1].indexOf('=')>0&&results[1].indexOf('*')>0){return $.urlParamStar(name);}else{return decodeURI(results[1])||0;}};$.parseUrl=function(url){let obj={},arr,arr2,i=0;if(Object.prototype.toString.call(url)!=='[object String]'){throw new Error('invalid argument');}
if(url.indexOf('?')==-1){return{};}
if(url.indexOf('&')>0){arr=url.split("?")[1].split("&");for(let l=arr.length;i<l;i++){obj[arr[i].split("=")[0]]=arr[i].split("=")[1];}}else{arr2=url.split("?")[1].split("*");for(let l=arr2.length;i<l;i++){obj[arr2[i].split("=")[0]]=arr2[i].split("=")[1];}}
return obj;};var util=require("../../common/commonutil");;(function(window,undefined){$(()=>{var isxjbk=$.urlParam("xjbk");function KSJK(options){this.options={page_id:options.page_id||util.getUUID(32,true),showAppInfo:options.showAppInfo||false,debug:options.debug||false,openHeart:options.openHeart||false,seconds:options.seconds||60,YXVersion:'121',YXVersionName:'1.2.1',host:options.host||''};};KSJK.prototype={userInfo:{},plusInfo:{},getCurrentPosition:function(){var position={};if(navigator.geolocation){navigator.geolocation.getCurrentPosition(position=>{return{longitude:position.coords.longitude*10E6,latitude:position.coords.latitude*10E6};},error=>{return{longitude:"",latitude:""};});}else{return{longitude:"",latitude:""};}},getPlusInfo:function(){var plus=window.plus||{};var device={IMEI:plus.device.imei,IMSI:plus.device.imsi,Model:plus.device.model,Vendor:plus.device.vendor,UUID:plus.device.uuid,Screen:plus.screen.resolutionWidth*plus.screen.scale+" x "+plus.screen.resolutionHeight*plus.screen.scale+"",DPI:plus.screen.dpiX+" x "+plus.screen.dpiY,OS:plus.os};var types={};types[plus.networkinfo.CONNECTION_UNKNOW]="未知";types[plus.networkinfo.CONNECTION_NONE]="未连接网络";types[plus.networkinfo.CONNECTION_ETHERNET]="有线网络";types[plus.networkinfo.CONNECTION_WIFI]="WiFi网络";types[plus.networkinfo.CONNECTION_CELL2G]="2G蜂窝网络";types[plus.networkinfo.CONNECTION_CELL3G]="3G蜂窝网络";types[plus.networkinfo.CONNECTION_CELL4G]="4G蜂窝网络";device.NetworkInfo=types[plus.networkinfo.getCurrentType()];device.OS={Language:plus.os.language,Version:plus.os.version,Name:plus.os.name,Vendor:plus.os.vendor};return device;},getPlatform:function(){var platform='other';var deviceAgent;if(navigator&&navigator.userAgent){deviceAgent=navigator.userAgent.toLowerCase();if(deviceAgent.indexOf("iphone")>=0){platform="iphone";}
if(deviceAgent.indexOf("ipod")>=0){platform="ipod";}
if(deviceAgent.indexOf("ipad")>=0){platform="ipad";}
if(deviceAgent.indexOf("android")>=0){platform="android";}}
return platform;},plusReady:function(){this.plusInfo=this.getPlusInfo();},addPlusReadyListener:function(){if(window.plus){this.plusReady();}else{document.addEventListener("plusready",this.plusReady,false);}},getNavigtorInfo:function(){if(navigator){this.userInfo.ua=navigator.userAgent;this.userInfo.platform=navigator.platform;if(/Linux/i.test(this.userInfo.platform)){this.userInfo.platform='Android';}
this.userInfo.language=navigator.language;this.userInfo.longitude="";this.userInfo.latitude="";if(navigator.platform=='iPhone'){this.userInfo.osVersion=navigator.userAgent.split(';')[1].split(' ')[4]?navigator.userAgent.split(';')[1].split(' ')[4].split('_').join('.'):'';}else{this.userInfo.osVersion=navigator.userAgent.split('Android')[1]?navigator.userAgent.split('Android')[1].split(';')[0]:'';if(!this.userInfo.osVersion){this.userInfo.osVersion=navigator.userAgent.split('Android')[1]?navigator.userAgent.split('Android')[1].split(';')[0]:'';}}
this.userInfo.channel=$.urlParam('utm_source');}},init:function(){this.addPlusReadyListener();this.getNavigtorInfo();this.userInfo.phone="";this.userInfo.page_id=this.options.page_id;this.userInfo.client_ip=window.returnCitySN?returnCitySN["cip"]||"":"";this.userInfo.client_region=window.returnCitySN?returnCitySN["cid"]||"":"CN";this.userInfo.url=location.origin+location.pathname;this.userInfo.screen=window.screen?window.screen.width+'*'+window.screen.height:'';this.userInfo.is_mobile=true;var urlParams=$.parseUrl(location.href);if(!urlParams.utm_campaign){urlParams["amp;utm_campaign"]&&(urlParams.utm_campaign=urlParams["amp;utm_campaign"]);}
if(!urlParams.utm_medium){urlParams["amp;utm_medium"]&&(urlParams.utm_medium=urlParams["amp;utm_medium"]);}
if(!urlParams.utm_source){urlParams["amp;utm_source"]&&(urlParams.utm_source=urlParams["amp;utm_source"]);}
Object.assign(this.userInfo,urlParams);this.pageEnter();this.bindEvent();if(this.options.openHeart){setInterval(()=>{this.pageHeart();},3000);}},postUserInfo:function(type,successCallback,errorCallback,options){var phone=$('.phone').val();if(!/^1\d{10}$/.test(phone)){this.userInfo.phone=$('.phone').val();}
var async=true;if(options){async=options.async===false?false:true;}
util.getServerTimestamp(timestamp=>{this.userInfo.timestamp=timestamp;this.userInfo.event_type=type;var url;if(this.options.debug){url=this.options.host+this.statisticUrl;}else{url=this.statisticUrl;}
if(this.options.showAppInfo){var testInfo=`ad_ip:${this.userInfo.client_ip}\r\n
            YX-Region:${this.userInfo.client_region}\r\n
            YX-Language:${this.userInfo.language}\r\n
            YX-Platform:${this.userInfo.platform}\r\n
            YX-Screen:${this.userInfo.screen}\r\n
            YX-Channel:${this.userInfo.channel}\r\n
            YX-OsVersion:${this.userInfo.osVersion}\r\n
            `;}
$.ajax({url:url,type:"POST",async:async,headers:{'YX-source':'web','YX-Timestamp':+new Date(),'YX-VersionName':this.options.YXVersionName,'YX-Version':this.options.YXVersion},contentType:'application/json; charset=utf-8',data:JSON.stringify(this.userInfo),dataType:'json',success:res=>{if(res.code===0){successCallback&&successCallback(res);}},error:(xhr,code,error)=>{errorCallback&&errorCallback(xhr,code,error);}});});},pageEnter:function(){this.postUserInfo(this.pageEventTypes.PAGE_ENTER,function(res){},function(xhr,code,error){});},pageHeart:function(){this.postUserInfo(this.pageEventTypes.PAGE_HEART,function(res){},function(xhr,code,error){});},pageEXIT:function(){this.postUserInfo(this.pageEventTypes.PAGE_EXIT,function(res){},function(xhr,code,error){},{async:false});},pageRegister:function(){var phone=$('.phone').val();var password=$('.password').val();var code=$('.code').val();if(!phone){util.dialogMsg('请输入手机号');return false;}else{if(!/^1\d{10}$/.test(phone)){util.dialogMsg("手机号码有误，请重填");return false;}else{this.userInfo.phone=$('.phone').val();}}
if(!password){util.dialogMsg('请输入密码');return false;}else{if(password.length>18||password.length<6){util.dialogMsg('请输入6-18位密码');return false;}}
if(!code){util.dialogMsg('请输入验证码');return false;}
var url;if(this.options.debug){url=this.options.host+this.registerUrl;}else{url=this.registerUrl;}
var $protocalCheck=$(".protocalCheck").prop("checked");if(!$protocalCheck){util.dialogMsg("请确定已阅读并同意注册服务协议！","确定",function(){});return false;}else{this.postUserInfo(this.pageEventTypes.REGISTER,function(res){},function(xhr,code,error){});$.ajax({url:url,type:'POST',headers:{'YX-source':'web','YX-Timestamp':+new Date(),'YX-VersionName':this.options.YXVersionName,'YX-Version':this.options.YXVersion,'YX-Region':this.userInfo.client_region,'YX-Platform':this.userInfo.platform,'YX-Language':this.userInfo.language,'ad_ip':this.userInfo.client_ip,'YX-Screen':this.userInfo.screen,'YX-Channel':this.userInfo.channel,'YX-OsVersion':this.userInfo.osVersion},contentType:'application/json; charset=utf-8',data:JSON.stringify({mobile:phone,passwd:password,td_key:'default',code:code}),dataType:'json',success:res=>{if(res.code===0){this.postUserInfo(this.pageEventTypes.REGISTER_SUCCESS,function(res){},function(xhr,code,error){});util.dialogMsg("恭喜您注册成功！","立即下载",()=>{this.downloadApp();});}else{if(res.code&&res.code==1308){util.dialogMsg(res.desc,"立即下载",()=>{this.downloadApp();return false;});}else{util.dialogMsg(res.desc,"确定",()=>{this.postUserInfo(this.pageEventTypes.REGISTER_FAILED,function(res){},function(xhr,code,error){});return false;});}}},error:(xhr,code,error)=>{util.dialogMsg("注册失败！"+error,"确定",()=>{this.postUserInfo(this.pageEventTypes.REGISTER_ERROR,function(res){},function(xhr,code,error){});});}});}},downloadApp:function(){this.pageDownload();this.openApp();},pageDownloadPhone:function(){var phone=$('.phone').val();if(!phone){util.dialogMsg('请输入手机号');return false;}else{if(!/^1\d{10}$/.test(phone)){util.dialogMsg("手机号码有误，请重填");return false;}else{this.userInfo.phone=$('.phone').val();this.postUserInfo(this.pageEventTypes.PHONE_DOWNLOAD,function(res){},function(xhr,code,error){});this.openApp();}}},pageDownload:function(){this.postUserInfo(this.pageEventTypes.DOWNLOAD,function(res){},function(xhr,code,error){});},getImgCode:function(){$('.getImgCode').attr('disabled',true);var url;if(this.options.debug){url=this.options.host+this.getImgCodeUrl;}else{url=this.getImgCodeUrl;}
$.ajax({url:url,type:"POST",contentType:'application/json; charset=utf-8',headers:{'YX-source':'web','YX-Timestamp':+new Date(),'YX-VersionName':this.options.YXVersionName,'YX-Version':this.options.YXVersion},data:JSON.stringify({}),dataType:'json',success:res=>{$('.getImgCode').attr('disabled',false);var data=res.data;if(res.code!==0){util.dialogMsg(res.desc,function(){});$('.btn-img-code-wrapper').css({border:'1px solid #00c77b'});return;}
if(data.result==1){$('.btn-img-code-wrapper').css({border:'none'});$(".getImgCode").attr("src",data.path);}else{util.dialogMsg(JSON.stringify(data),function(){});$('.btn-img-code-wrapper').css({border:'1px solid #00c77b'});}},error:(xhr,err,msg)=>{$('.getImgCode').attr('disabled',false);util.dialogMsg(msg,function(){});$('.btn-img-code-wrapper').css({border:'1px solid #00c77b'});}});},verifyImgCode:function(imgCode){var url;if(this.options.debug){url=this.options.host+this.verifyImgCodeUrl;}else{url=this.verifyImgCodeUrl;}
var result=false;$.ajax({url:url,type:"POST",async:false,contentType:'application/json; charset=utf-8',headers:{'YX-source':'web','YX-Timestamp':+new Date(),'YX-VersionName':this.options.YXVersionName,'YX-Version':this.options.YXVersion},data:JSON.stringify({phrase:imgCode}),dataType:'json',success:res=>{$('.getImgCode').attr('disabled',false);var data=res.data;if(res.code!==0){util.dialogMsg(res.desc||'获取失败，请重新获取！',function(){});return;}
if(data.result==2){result=true;}else if(data.result==1){util.dialogMsg("图形验证码错误，已刷新，请重新填写！");$('.btn-img-code-wrapper').css({border:'none'});$(".getImgCode").attr("src",data.path);}else{util.dialogMsg("图形验证码错误，请重新获取！");}},error:(xhr,err,msg)=>{$('.getImgCode').attr('disabled',false);util.dialogMsg(msg,function(){});}});return result;},getCode:function(){if($('.getCode').data('disabled')){return;}
var phone=$('.phone').val();if(!phone){util.dialogMsg('请输入手机号');return false;}else{if(!/^1\d{10}$/.test(phone)){util.dialogMsg("手机号码有误，请重填");return false;}else{this.userInfo.phone=$('.phone').val();}}
var seconds=this.options.seconds||60;$('.getCode').data('disabled',true);$('.getCode').css({"color":"#ffffff"}).text(seconds+'秒后重发').parent().css({"border":0,"background-color":'#c0c0c0'});seconds--;var url;if(this.options.debug){url=this.options.host+this.getCodeUrl;}else{url=this.getCodeUrl;}
$.ajax({url:url,type:'POST',headers:{'YX-source':'web','YX-Timestamp':+new Date(),'YX-VersionName':this.options.YXVersionName,'YX-Version':this.options.YXVersion},contentType:'application/json; charset=utf-8',data:JSON.stringify({type:'html',mobile:this.userInfo.phone}),dataType:'json',success:res=>{if(res.code===0){}else{if(res.code==1308){util.dialogMsg(res.desc,"立即下载",()=>{this.downloadApp();});}else{util.dialogMsg(res.desc||'获取失败，请稍候再试！',"确定",function(){});}}},error:(xhr,err,msg)=>{util.dialogMsg(msg,'确定',function(){});}});var timers=setInterval(()=>{if(seconds){$('.getCode').text(seconds+'秒后重发');seconds--;}else{clearInterval(timers);timers=null;seconds=0;$('.getCode').text("获取验证码").data('disabled',false).css("color","#d43e3b").parent().css({"background":"rgba(255,255,255,.2)","color":'#d43e3b'});}},1000);},bindEvent:function(){$(".protocalCheck").change(e=>{if($(".protocalCheck").prop("checked")==true){$(".protocalCheck").addClass('protocalChecked');this.postUserInfo(this.pageEventTypes.PAGE_PROTOCOL_Agree);}else{$(".protocalCheck").removeClass('protocalChecked');this.postUserInfo(this.pageEventTypes.PAGE_PROTOCOL_CANCEL);}});$(".openProtocal").on("click",()=>{this.postUserInfo(this.pageEventTypes.PAGE_PROTOCOL_VIEW);});$(".openPrivacyProtocal").on("click",()=>{this.postUserInfo(this.pageEventTypes.PAGE_PROTOCOL_PRIVACY_VIEW);});$('.register').on('click',()=>{this.pageRegister();});$(".phone").on('focus',function(){$(".labelPhone").show();});$(".phone").watch(value=>{var validValue;if(value.length<11){$(".download-phone").addClass('btn-download-disabled').removeClass("btn-background").attr('disabled',true);}else{$(".download-phone").removeClass('btn-download-disabled').addClass("btn-background").attr('disabled',false);}
if(value.length>11){validValue=value.substring(0,11);$('.phone').val(validValue);return;}});$(".phone").on('blur',()=>{this.postUserInfo(this.pageEventTypes.PAGE_PHONE);});$(".password").on('focus',function(){$(".labelPhone").hide();});$(".password").watch(value=>{var validValue;if(value.length>18){validValue=value.substring(0,18);$('.password').val(validValue);return;}});$(".password").on('blur',()=>{this.postUserInfo(this.pageEventTypes.PAGE_PASSWORD,function(res){},function(xhr,code,error){});});$(".code").watch(value=>{var validValue;if(value.length>6){validValue=value.substring(0,6);$('.code').val(validValue);return;}});$(".code").on('blur',()=>{this.postUserInfo(this.pageEventTypes.PAGE_CODE,function(res){},function(xhr,code,error){});});$(".labelPhone").on('click',function(e){e.stopPropagation();e.preventDefault();$(".phone").val("");$(this).hide();});$(".labelPassword").on("click",function(){if($(this).data("pass")=='on'){$(".password").attr('type',"text");$(this).data("pass","off");$(this).children().removeClass("icon-password-invisible").addClass("icon-password-visible");}else{$(".password").attr('type',"password");$(this).data("pass","on");$(this).children().removeClass("icon-password-visible").addClass("icon-password-invisible");}});$(".code").on('focus',function(){$(".labelPhone").hide();});$('.getImgCode').on("click",()=>{this.postUserInfo(this.pageEventTypes.PAGE_GETIMGCODE,function(res){},function(xhr,code,error){});this.getImgCode();});$('.getCode').on("click",()=>{this.postUserInfo(this.pageEventTypes.PAGE_GETCODE,function(res){},function(xhr,code,error){});this.getCode();});$('.go-login').on("click",()=>{this.postUserInfo(this.pageEventTypes.PAGE_LOGIN);});$('.openApp').on('click',()=>{this.openApp();});},isInstalled(platform){var storeUrl='';if(platform=='ios'){storeUrl='https://itunes.apple.com/cn/app/id1309415987?mt=8';}
if(platform=='android'){storeUrl='';}
window.location="haohuan://";setTimeout(function(){window.location=storeUrl;},500);},disableIOS:function(){var ua=navigator.userAgent;var platform={android:ua.indexOf('Android')>-1||ua.indexOf('Linux')>-1,iPhone:ua.indexOf('iPhone')>-1,iPad:ua.indexOf('iPad')>-1,isWeixin:ua.indexOf('MicroMessenger')>-1};return true;},openIframeApp:function(){var ua=navigator.userAgent;var platform={android:ua.indexOf('Android')>-1||ua.indexOf('Linux')>-1,androidVersion:0,iPhone:ua.indexOf('iPhone')>-1,iPad:ua.indexOf('iPad')>-1,iosVersion:0,wPhone:ua.indexOf('Windows Phone')>-1,isWeixin:ua.indexOf('MicroMessenger')>-1,mfAndroid:ua.indexOf('Android')>-1||ua.indexOf('Adr')>-1||ua.indexOf('Linux')>-1,mfAldb:ua.indexOf('magicloan')>-1};var out=/iPhone OS (\d+)/.exec(ua);if(out){platform.iosVersion=parseInt(out[1],10);}else if(out=/Android (\d+)/.exec(ua)){platform.androidVersion=parseInt(out[1],10);}
var browserHidden=function(){if(typeof document.hidden!=='undefined'){return document.hidden;}else if(typeof document.mozHidden!=='undefined'){return document.mozHidden;}else if(typeof document.msHidden!=='undefined'){return document.msHidden;}else if(typeof document.webkitHidden!=='undefined'){return document.webkitHidden;}
return false;};function callNative(url,callback,universalLinks){if(!url){return;}
var oFrame=document.createElement('iframe');oFrame.style.display='none';var body=document.body;var timer;var clear=function(evt,isTimeout){typeof callback==='function'&&callback(isTimeout);window.removeEventListener('pagehide',hide,true);if(!oFrame){return;}
oFrame.onload=null;body.removeChild(oFrame);oFrame=null;};var hide=function(e){clearTimeout(timer);clear(e,false);};var timer1=70,timer2=1200,timerDuration=1300;window.addEventListener('pagehide',hide,true);if(platform.iosVersion>=9){oFrame=null;if(universalLinks&&this.options.isDebug){window.location.href=universalLinks;}else{window.location.href=url;}}else{oFrame.onload=clear;oFrame.src=url=='http://haohuan'?"haohuan://":url;body.appendChild(oFrame);}
var startTime=+new Date();timer=setTimeout(function(){timer=setTimeout(function(){var newTime=+new Date();var duration=newTime-startTime;if(duration>timerDuration){clear(null,false);}else if(!browserHidden()){clear(null,true);}},timer2);},timer1);}
!function(){var YING_YONG_BAO_URL='http://sj.qq.com/myapp/detail.htm?apkName=com.renrendai.haohuan';var appStoreURL='https://itunes.apple.com/cn/app/id1309415987?mt=8';var androidDownloadURL='https://m.haohuan.com/download/android/haohuan_release.apk';var APP_SCHEMA="http://haohuan";var universalLinks='https://api-m.haohuan.com?debug=true';if(platform.mfAndroid&&platform.mfAldb){APP_SCHEMA="aldb://magincloan?v=1.1&p=haohuan://";androidDownloadURL='aldb://magincloan?v=1.1&p=https://m.haohuan.com/download/android/haohuan_release.apk';}
if(isxjbk){androidDownloadURL='https://hn.xianjincard.com/download?url=https://m.haohuan.com/download/android/haohuan_release.apk';appStoreURL='itms-appss://itunes.apple.com/cn/app/id1309415987?mt=8';}
if(platform.wPhone){util.dialogMsg('抱歉，暂不支持您的设备');return;}
var finalDownloadURL=androidDownloadURL;if(platform.iPhone||platform.iPad){APP_SCHEMA="haohuan://";finalDownloadURL=appStoreURL;if(!platform.isWeixin){if($.urlParam('utm_source')=='xrqb'){appStoreURL='itms-appss://itunes.apple.com/cn/app/id1309415987?mt=8';}else{appStoreURL='https://itunes.apple.com/cn/app/id1309415987?mt=8';}
window.location.href=appStoreURL;util.removeLoading();return false;}}
if(platform.isWeixin){APP_SCHEMA=null;finalDownloadURL=YING_YONG_BAO_URL;}
if(APP_SCHEMA){callNative(APP_SCHEMA,function(isTimeout){util.removeLoading();if(isTimeout){setTimeout(function(){window.location.href=finalDownloadURL;},0);}else{window.location.href=finalDownloadURL;return false;}},universalLinks);}else{util.removeLoading();location.href=finalDownloadURL;}}();},openApp:function(){util.loading("2");this.openIframeApp();return;},pageEventTypes:{PAGE_ENTER:"page_enter",PAGE_EXIT:'page_exit',DOWNLOAD:"download",REGISTER:'register',REGISTER_SUCCESS:'register_success',REGISTER_ERROR:'register_error',REGISTER_FAILED:'register_failed',PHONE_DOWNLOAD:'phone_download',PAGE_HEART:'page_heart',PAGE_PHONE:'page_phone',PAGE_GETIMGCODE:'page_getimgcode',PAGE_GETCODE:'page_getcode',PAGE_PASSWORD:'page_password',PAGE_CODE:'page_code',PAGE_PROTOCOL_Agree:'page_protocol_agree',PAGE_PROTOCOL_CANCEL:'page_protocol_cancel',PAGE_PROTOCOL_VIEW:'page_protocol_view',PAGE_PROTOCOL_PRIVACY_VIEW:'page_protocol_privacy_view',PAGE_LOGIN:'page_login'},statisticUrl:'/api/v1/other/statistic-promotion',registerUrl:'/api/v1/account/register',getCodeUrl:'/api/v1/sms/send-verify-code',getImgCodeUrl:'/captcha/get-captcha-image',verifyImgCodeUrl:'/captcha/verify-captcha-image'};var ksjk=new KSJK({page_id:util.getUUID(32,true),xjbk:$.urlParam('xjbk'),debug:$.urlParam('debug')});ksjk.init();var unlodFlag=false;window.onbeforeunload=function(e){if(!unlodFlag){unlodFlag=true;ksjk.pageEXIT();}};});})(window);